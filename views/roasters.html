{% extends "/views/base.html" %}

{% block main %}
  {{doc.html|safe}}
  <ul>
    {% for roaster in g.docs('roasters')|sort(attribute='title') %}
    <li><a href={{roaster.url.path}}>{{roaster.title}}</a> {% if roaster.favorite %}<span>â˜…</span>{% endif %}
    {% endfor %}
  </ul>

  {% set map_data = {
    'zoom': g.yaml('/content/shared/map.yaml?zoom'),
    'center': g.yaml('/content/shared/map.yaml?center'),
    'locations': {},
    'use_links': True,
  } %}
  {% for map_doc in g.docs('roasters') %}
    {% for location in map_doc.locations %}
      {% do map_data['locations'].update({
        map_doc.title: {
          'location': location,
          'url': map_doc.url.path,
        },
      }) %}
    {% endfor %}
  {% endfor %}

  {% with partial = map_data %}
    {% include '/partials/map/map.html' with context %}
  {% endwith %}
{% endblock %}
